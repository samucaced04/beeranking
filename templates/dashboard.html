{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h2>ğŸ† Ranking Semanal (Semana {{ current_week }})</h2>
        
        <!-- FORMULÃRIO PARA ADICIONAR PROBLEMAS - ATUALIZADO -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">ğŸ“Š Adicionar Problemas de Hoje</h5>
                <form method="POST" action="{{ url_for('add_problems') }}">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Quantos problemas resolveu AGORA?</label>
                            <input type="number" class="form-control" name="problems_solved" 
                                   min="1" max="20" value="1" required>
                            <small class="text-muted">NÃºmero de problemas resolvidos desde a Ãºltima atualizaÃ§Ã£o</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-success w-100">
                                â• Adicionar Problemas
                            </button>
                        </div>
                    </div>
                    <small class="text-muted">
                        ğŸ’¡ Digite quantos problemas vocÃª resolveu desde a Ãºltima vez que atualizou
                    </small>
                </form>
            </div>
        </div>

        <!-- RANKING -->
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>PosiÃ§Ã£o</th>
                        <th>UsuÃ¡rio</th>
                        <th>Problemas Resolvidos</th>
                        <th>BeeCrowd ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_data in ranking %}
                    <tr class="{% if user_data.username == session.username %}table-primary{% endif %}">
                        <td>
                            {% if loop.index == 1 %}ğŸ¥‡
                            {% elif loop.index == 2 %}ğŸ¥ˆ
                            {% elif loop.index == 3 %}ğŸ¥‰
                            {% else %}{{ loop.index }}
                            {% endif %}
                        </td>
                        <td>
                            {{ user_data.username }}
                            {% if user_data.username == session.username %}<strong>(VocÃª)</strong>{% endif %}
                        </td>
                        <td>
                            <span class="badge bg-success">{{ user_data.problems_solved }}</span>
                        </td>
                        <td>
                            <small class="text-muted">{{ user_data.beecrowd_id }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">ğŸ‘¥ Adicionar Amigo</h5>
                <form method="POST" action="{{ url_for('add_friend') }}">
                    <div class="mb-3">
                        <label class="form-label">BeeCrowd ID do amigo</label>
                        <input type="number" class="form-control" name="friend_id" required>
                        <small class="text-muted">NÃºmero do perfil do amigo (ex: 12345)</small>
                    </div>
                    <button type="submit" class="btn btn-success w-100">â• Adicionar Amigo</button>
                </form>
            </div>
        </div>
        <!-- No dashboard.html, depois do card de amigo -->
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title">ğŸ“ˆ AnÃ¡lise de Progresso</h5>
                <p>Acompanhe sua evoluÃ§Ã£o semana a semana</p>
                <a href="{{ url_for('progresso') }}" class="btn btn-warning w-100">
                    ğŸ“Š Ver GrÃ¡ficos de Progresso
                </a>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title">ğŸ“ˆ Seu Progresso</h5>
                <p><strong>ğŸ Seu BeeCrowd ID:</strong> {{ user.beecrowd_id }}</p>
                <p><strong>ğŸ… Sua PosiÃ§Ã£o:</strong> 
                    {% for user_data in ranking %}
                        {% if user_data.username == session.username %}
                            <span class="badge bg-primary">{{ loop.index }}Âº Lugar</span>
                        {% endif %}
                    {% endfor %}
                </p>
                <p><strong>âœ… Problemas da Semana:</strong> 
                    {% for user_data in ranking %}
                        {% if user_data.username == session.username %}
                            <span class="badge bg-success">{{ user_data.problems_solved }} resolvidos</span>
                        {% endif %}
                    {% endfor %}
                </p>
                
                <!-- BOTÃƒO DE SINCRONIZAÃ‡ÃƒO -->
                <div class="mt-3">
                    <a href="{{ url_for('sync_beecrowd') }}" class="btn btn-info btn-sm w-100">
                        ğŸ”„ Sincronizar com BeeCrowd
                    </a>
                    <small class="text-muted">
                        Pega automaticamente seu total de problemas
                    </small>
                </div>

                <!-- INFO DO SISTEMA -->
                <div class="mt-3 p-2 bg-light rounded">
                    <small class="text-muted">
                        <strong>ğŸ’¡ Como funciona:</strong><br>
                        â€¢ <strong>Adicionar Problemas</strong>: Some ao seu total de hoje<br>
                        â€¢ <strong>Sincronizar</strong>: Pega seu total do BeeCrowd<br>
                        â€¢ Ranking: Soma todos os dias da semana
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
