{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>üìä Meu Progresso</h2>
        <p class="text-muted">Visualize sua evolu√ß√£o nas √∫ltimas semanas</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">üìà Progresso Semanal</h5>
                <canvas id="progressChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">üìã Estat√≠sticas</h5>
                <div id="statsContainer">
                    <!-- JavaScript vai preencher aqui -->
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title">üí° Dicas</h5>
                <small class="text-muted">
                    ‚Ä¢ Mantenha uma rotina consistente<br>
                    ‚Ä¢ Estabele√ßa metas semanais<br>
                    ‚Ä¢ Revise problemas anteriores<br>
                    ‚Ä¢ Comemore seu progresso!
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js CDN - BIBLIOTECA DE GR√ÅFICOS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Dados do progresso (vindos do Python via Jinja2)
const weeklyData = {{ weekly_data | tojson }};
const currentWeek = {{ current_week }};
const stats = {{ stats | tojson }};

console.log("üìä Dados recebidos:", weeklyData);
console.log("üìà Estat√≠sticas:", stats);

// Preparar dados para o gr√°fico
const labels = weeklyData.map(data => `Semana ${data.week}`);
const problemsData = weeklyData.map(data => data.problems_solved);

// Preencher estat√≠sticas na p√°gina (usando stats do Python)
document.getElementById('statsContainer').innerHTML = `
    <p><strong>üìÖ Total (6 semanas):</strong> <span class="badge bg-primary">${stats.total} problemas</span></p>
    <p><strong>üìä M√©dia Semanal:</strong> <span class="badge bg-info">${stats.average.toFixed(1)} problemas</span></p>
    <p><strong>üèÜ Melhor Semana:</strong> <span class="badge bg-success">${stats.best_week} problemas</span></p>
    <p><strong>üéØ Semana Atual:</strong> <span class="badge bg-secondary">Semana ${currentWeek}</span></p>
`;

// Criar gr√°fico de linha
const ctx = document.getElementById('progressChart').getContext('2d');
const progressChart = new Chart(ctx, {
    type: 'line',  // Tipo: Gr√°fico de LINHA
    data: {
        labels: labels,  // Eixo X: Semanas
        datasets: [{
            label: 'Problemas Resolvidos',  // Legenda
            data: problemsData,  // Eixo Y: N√∫meros
            borderColor: '#28a745',  // Cor da linha (verde)
            backgroundColor: 'rgba(40, 167, 69, 0.1)',  // Cor de fundo (verde claro)
            borderWidth: 3,  // Espessura da linha
            fill: true,  // Preencher √°rea abaixo da linha
            tension: 0.4,  // Suavizar a linha (curvas)
            pointBackgroundColor: '#28a745',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8
        }]
    },
    options: {
        responsive: true,  // Gr√°fico responsivo
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true,
                position: 'top'
            },
            title: {
                display: true,
                text: 'Evolu√ß√£o Semanal',  // T√≠tulo do gr√°fico
                font: {
                    size: 16
                }
            },
            tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                padding: 10
            }
        },
        scales: {
            y: {
                beginAtZero: true,  // Eixo Y come√ßa no zero
                title: {
                    display: true,
                    text: 'Problemas Resolvidos',  // Label eixo Y
                    font: {
                        weight: 'bold'
                    }
                },
                grid: {
                    color: 'rgba(0, 0, 0, 0.1)'
                }
            },
            x: {
                title: {
                    display: true,
                    text: 'Semanas',  // Label eixo X
                    font: {
                        weight: 'bold'
                    }
                },
                grid: {
                    color: 'rgba(0, 0, 0, 0.1)'
                }
            }
        },
        interaction: {
            intersect: false,
            mode: 'nearest'
        },
        animations: {
            tension: {
                duration: 1000,
                easing: 'linear'
            }
        }
    }
});

console.log("‚úÖ Gr√°fico criado com sucesso!");
</script>

<style>
.card {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: none;
    border-radius: 10px;
}

.card-body {
    padding: 1.5rem;
}

.badge {
    font-size: 0.8em;
    padding: 0.4em 0.6em;
}

#progressChart {
    max-height: 300px;
    width: 100%;
}
</style>
{% endblock %}
